<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
</head>
<body>
  <a href="https://p.pinduoduo.com/1ETXW09c">https://p.pinduoduo.com/1ETXW09c</a>
  <a href="https://s.click.taobao.com/J4Q8K2w">https://s.click.taobao.com/J4Q8K2w</a>

  <!-- script>
    window.location.href="amihexin://backwash_userid=&backwash_source=wap&backwash_hxapp=&url"
  </script -->
  <Button onclick="ja()">js传值给Java</Button>
  <script>
    var EventTarget = function EventTarget() {
    this.handlers = {};
}

EventTarget.prototype = {
    //订阅消息
    addHandler : function(type, handler) {
        if (typeof this.handlers[type] == "undefined") {
            this.handlers[type] = [];
        }
        
        this.handlers[type].push(handler);
    },
    
    //发布消息
    fire : function(event) {
        if (!event.target) {
            event.target = this;
        }
        if (this.handlers[event.type] instanceof Array) {
            var handlers = this.handlers[event.type];
            for (var i = 0, len = handlers.length; i < len; i++) {
                handlers[i](event);
            }
            if (event.isOne) {
                this.removeAllHandler(event.type);
            }
        }
    },
    
    //取消订阅
    removeHandler : function(type, handler) {
        if (this.handlers[type] instanceof Array) {
            var handlers = this.handlers[type];
            for (var i = 0, len = handlers.length; i < len; i++) {
                if (handlers[i] === handler) {
                    break;
                }
            }
            handlers.splice(i, 1);
        }
    },
    // 取消所有订阅
    removeAllHandler: function(type) {
        delete this.handlers[type];
    }
};
var jyQuery = function () {
    this.isAndroid = false;
    this.isIOS = false;
    this.params = {};
    this.events = new EventTarget();

    // ResponseType 返回格式 【plain 返回源码文本】
    this.ResponseType = {"json": 0, "plain": 2};
}
jyQuery.prototype = {
    // 初始化 原生端触发：userJyQuery.__init__("android", {});
    __init__: function (platform, params) {
        if (platform == "ios") {
            this.isIOS = true;
            this.isAndroid = false;
        } else if (platform == "android") {
            this.isAndroid = true;
            this.isIOS = false;
        } else {
            this.isIOS = false;
            this.isAndroid = false;
        }
        this.params = params;
        this.onload();
    },
    // 接收原生端消息 原生端触发：userJyQuery.__event__(event);
    __event__: function(data) {
        this.events.fire(data);
    },
    // data 必须传入 Object {}
    pushToNative: function (action, data) {
        if (typeof data != "object") {
            console.error("data 值必须是 Object");
            return ;
        }
        if (this.isIOS) {
            jyObj(action, JSON.stringify(data));
        } else {
            jyObj.manager(action, JSON.stringify(data));
        }
    },
    // options = {
    //     method: "post/get",
    //     connectTimeout: 5000,
    //     receiveTimeout: 5000,
    //     headers: {
    //         "token": "dasdasdas"
    //     },
    //     responseType: this.ResponseType["json"],
    //     contentType: "text/html; charset=utf-8",
    //     followRedirects: false,
    //     maxRedirects: 10,
    // }
    // onSuccess function(data){}
    // onError function(code, msg) {}

    // ajax 原生端 返回数据
    // {
    //      "type": "uuid", // 这里是发送请求时的UUID
    //      "code": 200,
    //      "data": '<a></a>',
    //      "msg": "错误信息"
    // }
    ajax: function (url, method, data, options, onSuccess, onError) {
        if (typeof params != "object") {
            console.error("params 值必须是 Object");
            return ;
        }
        var uuid = this.uuid();
        this.pushToNative("ajax", {
            uuid: uuid,
            url: url,
            method: method,
            data: data,
            options: options == null ? {} : options,
        });
        this.events.addHandler(uuid, function(event){
            if (event.code == 200) {
                onSuccess(event.data);
            } else {
                onError(event.code, event.msg);
            }
        });
    },
    ajaxName: function (apiName, method, data, options, v, onSuccess, onError) {
        var uuid = this.uuid();
        this.pushToNative("ajaxName", {
            uuid: uuid,
            apiName: apiName,
            method: method,
            data: data,
            version: v == null ? "2.0": v,
            options: options == null ? {} : options,
        });
        this.events.addHandler(uuid, function(event){
            if (event.code == 200) {
                onSuccess(event.data);
            } else {
                onError(event.code, event.msg);
            }
        });
    },
    // callback function(rest){};
    // params 必须是 Object
    publicAction: function(action, params, callback) {
        if (typeof params != "object") {
            console.error("params 值必须是 Object");
            return ;
        }
        var uuid = this.uuid();
        this.pushToNative(action, Object.assign({
            uuid: uuid
        }, params));
        this.events.addHandler(uuid, callback == null ? function(v){} : callback);
    },
    onload: function () { },
    uuid: function() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0,
                v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }
}

userJyQuery = new jyQuery();
  function ja(){
    userJyQuery.ajax(
        "https://hetian9288.github.io/64g/d.html", 
        "get", 
        {"id": 12}, 
        {responseType: userJyQuery.ResponseType["plain"]}, 
        function(data){
            alert(data);
        }, 
        function(code, err){
            alert(code + "-" + err);
        }
    )
  }
  </script>
</body>
</html>
